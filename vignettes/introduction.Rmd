---
title: "Introduction to {mmetrics} package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to {mmetrics} package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


This vignette shows you how to use `{mmetrics}` package.

## Create Dummy Data
First, we create dummy data for this example.
```{r}
# Dummy data
df <- data.frame(
  gender = rep(c("M", "F"), 5),
  age = (1:10)*10,
  cost = c(51:60),
  impression = c(101:110),
  click = c(0:9)*3,
  conversion = c(0:9)
)

head(df)
```

## Define metrics
As a next step, we define metrics to evaluate using `mmetrics::define`. 
```{r}
# Example metrics
metrics <- mmetrics::define(
  cost = sum(cost),
  ctr  = sum(click)/sum(impression)
)
```

## How to use mmetrics::add() 

### mmetrics::add() with sigle grouping key
Call `mmetrics::add()` with grouping key (here `gender`) then we will get new `data.frame` with defined metrics.
```{r}
mmetrics::add(df, gender, metrics = metrics)
```

### mmetrics::add() with multiple grouping keys
We can also use multiple grouping keys.
```{r}
mmetrics::add(df, gender, age, metrics = metrics)
```

### mmetrics::add() without any grouping keys
Summarize all data when you do not specify any grouping keys.
```{r}
mmetrics::add(df, metrics = metrics)
```

When you set `summarize = FALSE` , `mmetrics::add()` behave like `dplyr::mutate()`.
```{r}
mmetrics::add(df, metrics = metrics, summarize = FALSE)
```

In this situation, `mmetrics::disaggregate()` is used inside to disaggregate metrics.
See the result of `disaggregate(metrics)` to check whether output metrics is what you want.
```{r}
mmetrics::disaggregate(metrics)
```
